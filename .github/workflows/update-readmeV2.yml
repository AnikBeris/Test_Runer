name: V2 UPDATE-README

# –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
on:
  workflow_dispatch:                                 # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∏–∑ –≤–∫–ª–∞–¥–∫–∏ Actions
  schedule:
    - cron: '10 9 * * *'                             # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:10 UTC (= 12:10 –ø–æ –ú–æ—Å–∫–≤–µ)
  push:
    branches: [ main ]
    paths:
      - ".github/README_PARTS/*"                     # –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –ø–∞–ø–∫–µ —Å —á–∞—Å—Ç—è–º–∏
      - ".github/README_PARTS/5.MAIN_Article_*.md"   # –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ ‚Äî –Ω–æ–≤—ã–µ –∏–ª–∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏

# –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä—è–º–æ–≥–æ –ø—É—à–∞ –≤ main)
permissions:
  contents: write

jobs:
  build-readme:
    runs-on: ubuntu-latest
    name: üìÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è README.md –∏–∑ —á–∞—Å—Ç–µ–π

    steps:
      # 1. –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—É—Å–∫–µ
      - name: üîÑ –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–ø—É—Å–∫–µ
        run: |
          echo "–ó–∞–ø—É—â–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ–º: ${{ github.event_name }}"
          echo "–†–∞–Ω–Ω–µ—Ä: ${{ runner.os }}-${{ runner.arch }}"
          echo "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}"
          echo "–í–µ—Ç–∫–∞: ${{ github.ref_name }}"
          date

      # 2. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é
      - name: üì• –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4
        with:
          fetch-depth: 0        # –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –¥–ª—è git push
          clean: true           # —á–∏—Å—Ç–∞—è —Ä–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞

      # 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º git –ø–æ–¥ –±–æ—Ç–∞
      - name: üìå –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Git (github-actions[bot])
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"

      # 4. –°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Å–±–æ—Ä–∫–∞ README.md
      - name: üìÇ –°–±–æ—Ä–∫–∞ README.md –∏–∑ —á–∞—Å—Ç–µ–π
        run: |
          # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ü—É—Ç–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          PARTS=".github/README_PARTS"
          OUTPUT="README.md"

          HEADER="$PARTS/1.HEADER.md"
          DESCRIPTION="$PARTS/2.DESCRIPTION.md"
          DONATION="$PARTS/3.DONATION.md"
          NAV="$PARTS/4.NAV.md"
          MAIN_Header="$PARTS/5.MAIN_Header.md"
          FOOTER="$PARTS/6.FOOTER.md"

          # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç–∞—Ç–µ–π, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –Ω–æ–º–µ—Ä—É (01, 02, 10 –∏ —Ç.–¥.)
          MAIN_ARTICLES=$(ls "$PARTS"/5.MAIN_Article_*.md 2>/dev/null | sort -V || echo "")

          echo "üìÑ –ù–∞–π–¥–µ–Ω—ã —Å—Ç–∞—Ç—å–∏ MAIN_Article_:"
          echo "$MAIN_ARTICLES" | sed 's/^/  ‚Ä¢ /'

          # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          for file in "$HEADER" "$DESCRIPTION" "$DONATION" "$NAV" "$MAIN_Header" "$FOOTER"; do
            if [[ ! -f "$file" ]]; then
              echo "‚ùå –û–®–ò–ë–ö–ê: –Ω–µ –Ω–∞–π–¥–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª $file"
              exit 1
            fi
          done

          # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –°–∞–º–∞ —Å–±–æ—Ä–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
          echo "‚úÖ –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É $OUTPUT ‚Ä¶"

          > "$OUTPUT"   # –æ—á–∏—â–∞–µ–º —Ñ–∞–π–ª (–∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π)

          cat "$HEADER"        >> "$OUTPUT"; echo -e "\n\n" >> "$OUTPUT"
          cat "$DESCRIPTION"   >> "$OUTPUT"; echo -e "\n\n" >> "$OUTPUT"
          cat "$DONATION"      >> "$OUTPUT"; echo -e "\n\n" >> "$OUTPUT"
          cat "$NAV"           >> "$OUTPUT"; echo -e "\n\n" >> "$OUTPUT"
          cat "$MAIN_Header"   >> "$OUTPUT"; echo -e "\n\n" >> "$OUTPUT"

          # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ç—å–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É
          if [[ -n "$MAIN_ARTICLES" ]]; then
            for article in $MAIN_ARTICLES; do
              echo "üìå –î–æ–±–∞–≤–ª—è–µ–º $(basename "$article")"
              cat "$article" >> "$OUTPUT"
              echo -e "\n\n" >> "$OUTPUT"
            done
          else
            echo "‚ùå –í–Ω–∏–º–∞–Ω–∏–µ: —Å—Ç–∞—Ç–µ–π 5.MAIN_Article_*.md –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
          fi

          cat "$FOOTER" >> "$OUTPUT"
          echo -e "\n" >> "$OUTPUT"   # —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ (–∫—Ä–∞—Å–∏–≤–æ)

          echo "‚úÖ README.md —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω!"

      # 5. –ö–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ main
      - name: Commit & Push –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ README.md
        run: |
          git add README.md

          if git diff --staged --quiet; then
            echo "‚ùå ‚úÖ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ README.md ‚Äî –∫–æ–º–º–∏—Ç –Ω–µ –Ω—É–∂–µ–Ω"
            exit 0
          fi

          git commit -m "chore: auto-update README from parts

          –°–æ–±—ã—Ç–∏–µ: ${{ github.event_name }}
          SHA: ${{ github.sha }}"

          # –ü—É—à–∏–º –Ω–∞–ø—Ä—è–º—É—é –≤ main (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –Ω–∞ –¥—Ä—É–≥—É—é –≤–µ—Ç–∫—É)
          git push origin HEAD:main

          echo "‚úÖ README.md –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –∑–∞–ø—É—à–µ–Ω –≤ main"